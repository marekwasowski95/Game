<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title></title>
    <meta name="description" content="">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="">
  </head>
  <body>
    <button id="createRoom">Stwórz pokój</button>
    <button id="updateRoom">Aktualizuj pokój</button>
    <hr>
    <input type="text" id="roomId"><button id="joinRoom">Dołącz do pokoju</button>
    
    <script async defer>
      const roomIdInput = document.getElementById('roomId');
      const createRoomBtn = document.getElementById('createRoom');
      const updateRoomBtn = document.getElementById('updateRoom');
      const joinRoomBtn = document.getElementById('joinRoom');
      const websocket = new WebSocket('ws://localhost:1337');
      let ROOM_ID = '0000';

      joinRoomBtn.addEventListener('click', () => {
        websocket.send(JSON.stringify({
          method: 'join_room',
          payload: {
            id: roomIdInput.value
          }
        }));
      });

      createRoomBtn.addEventListener('click', () => {
        websocket.send(JSON.stringify({
          method: 'create_room'
        }));
      });

      updateRoomBtn.addEventListener('click', () => {
        websocket.send(JSON.stringify({
          method: 'update_room',
          payload: {
            id: ROOM_ID,
            data: {
              suma: Math.floor(Math.random() * 1e5)
            }
          }
        }));
      });


      websocket.onopen = function(evt) {
        console.log('OPEN', evt);
      };

      websocket.onmessage = function(evt) {
        const res = JSON.parse(evt.data);
        if (res.response === 'room_created') {
          ROOM_ID = res.payload.id;
        }
        console.log('message received', evt);
      };

      websocket.onerror = function(evt) {
        console.log('error', evt);
      };
    </script>
  </body>
</html>